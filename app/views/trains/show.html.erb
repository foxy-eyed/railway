<h1>Train</h1>

<p>
  <strong>Number:</strong>
  <%= @train.number %>
</p>

<p>
  <strong>Current station:</strong>
  <% if @train.current_station.present? %>
      <%= link_to @train.current_station.title, @train.current_station %>
  <% else %>
      not set
  <% end %>
</p>

<p>
  <strong>Route:</strong>
  <% if @train.route.present? %>
      <%= link_to @train.route.name, @train.route %>
  <% else %>
      not set
  <% end %>
</p>

<h2>Wagons:</h2>
<div>
  <span><%= link_to '+ Add wagon', new_train_wagon_path(@train) %></p></span>
  <table>
    <thead>
    <tr>
      <th>Number</th>
      <th>Type</th>
      <th>Places</th>
      <th colspan="3"></th>
    </tr>
    </thead>
    <tbody>
    <% @train.ordered_wagons.each do |wagon| %>
        <tr>
          <td><%= link_to wagon.number, wagon_path(wagon) %></td>
          <td><%= wagon.type_label %></td>
          <td><%= render "wagons/places_#{wagon.type.underscore}", wagon: wagon %></td>
          <td><%= link_to 'Show', wagon_path(wagon) %></td>
          <td><%= link_to 'Edit', edit_wagon_path(wagon) %></td>
          <td><%= link_to 'Destroy', wagon_path(wagon), method: :delete, data: {confirm: 'Are you sure?'} %></td>
        </tr>
    <% end %>
    </tbody>
  </table>
</div>

<h2>Places count by type:</h2>
<table>
  <thead>
  <tr>
    <th>Wagon type</th>
    <th>Place type</th>
    <th>Count</th>
  </tr>
  </thead>
  <tbody>
    <% Wagon::TYPES.each do |wagon_type, wagon_label| %>
      <% Wagon::PLACE_TYPES.each do |place_type, place_label| %>
          <% count = @train.capacity_by_type(wagon_type, place_type) %>
          <% if count > 0 %>
            <tr>
              <td><%= wagon_label %></td>
              <td><%= place_label %></td>
              <td><%= count %></td>
            </tr>
          <% end %>
      <% end %>
    <% end %>
  </tbody>
</table>

<%= link_to 'Edit', edit_train_path(@train) %> |
<%= link_to 'Back', trains_path %>
